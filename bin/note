#!/usr/bin/env bash
set -o nounset -o errexit -o pipefail

NOTES_DIRECTORY="$HOME/Dropbox/Notes"
TODAY="$(date +%Y-%m-%d)"

function edit() {
    exec "$EDITOR" "$1"
}

function todo {
    edit "$(find "$NOTES_DIRECTORY" -name '*-todo.txt' | tail -n1)"
}

function new_note {
    note="$NOTES_DIRECTORY/$TODAY-$1.txt"
    if [[ ! -f "$note" ]]; then
        echo "# $1" >"$note"
    fi
    edit "$note"
}

case "$1" in
    "todo")
        todo
        ;;
    *)
        new_note "$1"
        ;;
esac
